/*
 * Copyright (c) 2025 Huawei Device Co., Ltd.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

@!sts_inject_into_module("import type { AsyncCallback } from '@ohos.base';")
@!sts_inject_into_module("import type rpc from '@ohos.rpc';")

@!namespace("@ohos.driver.deviceManager", "deviceManager")

@!sts_inject("""
static { loadLibrary("device_manager_taihe_native.z") }
""")

function queryDevices(busType: Optional<i32>): Array<DeviceUnion>;

function queryDeviceInfo(deviceId: Optional<u64>): Array<DeviceInfoUnion>;

function queryDriverInfo(driverUid: Optional<String>): Array<DriverInfoUnion>;

@!sts_inject("export native function bindDriverWithDeviceId(deviceId: long, onDisconnect: AsyncCallback<long>): Promise<RemoteDeviceDriver>;")
@gen_promise("unbindDriverWithDeviceId")
function UnbindDriverWithDeviceIdSync(deviceId: u64): i32;

enum BusType : i32 {
  USB = 1,
}

struct Device {
  busType: BusType;
  deviceId: u64;
  description: String;
}

struct USBDevice {
  @extends base: Device;
  vendorId: i32;
  productId: i32;
}

union DeviceUnion {
  t1: USBDevice;
  t: Device;
}

struct RemoteDeviceDriver {
  deviceId: u64;
  remote: @sts_type("rpc.IRemoteObject") Opaque;
}

struct USBInterfaceDesc {
  bInterfaceNumber: i32;
  bClass: i32;
  bSubClass: i32;
  bProtocol: i32;
}

struct DeviceInfo {
  deviceId: u64;
  isDriverMatched: bool;
  driverUid: Optional<String>;
}

struct USBDeviceInfo {
  @extends base: DeviceInfo;
  vendorId: i32;
  productId: i32;
  interfaceDescList: Array<USBInterfaceDesc>;
}

union DeviceInfoUnion {
    t1: USBDeviceInfo;
    t: DeviceInfo;
}

struct DriverInfo {
  busType: BusType;
  driverUid: String;
  driverName: String;
  driverVersion: String;
  driverSize: String;
  description: String;
}

struct USBDriverInfo {
  @extends base: DriverInfo;
  productIdList: Array<i32>;
  vendorIdList: Array<i32>;
}

union DriverInfoUnion {
    t1: USBDriverInfo;
    t: DriverInfo;
}
